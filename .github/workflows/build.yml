name: Build NixOS Configuration

on:
  push:
    branches:
      - master
  workflow_dispatch:


jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install Nix
        uses: cachix/install-nix-action@v21
        with:
          nix_version: "latest"

      - name: Use Cachix
        uses: cachix/cachix-action@v12
        with:
          name: "<cachix-cache-name>"
          signing_key: ${{ secrets.CACHIX_SIGNING_KEY }}

      - name: Build configuration.nix
        run: |
          nix-build '<nixpkgs/nixos>' \
            -I nixos-config=./configuration.nix \
            -A system
